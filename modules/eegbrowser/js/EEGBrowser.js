!function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(14),_react2=_interopRequireDefault(_react),_withPromise=__webpack_require__(15),_RegionSelect=__webpack_require__(16),_MRIViewer=__webpack_require__(20),_SignalSelectionFilter=__webpack_require__(26),_SignalPlots=__webpack_require__(27),_fetchWrapper=__webpack_require__(19),_EEGData=__webpack_require__(17),EEGBrowser=function(_Component){function EEGBrowser(props){_classCallCheck(this,EEGBrowser);var _this=_possibleConstructorReturn(this,(EEGBrowser.__proto__||Object.getPrototypeOf(EEGBrowser)).call(this,props)),brain=props.brain;return(0,_EEGData.instantiateRegions)(brain),_this.state={brain:brain,selected:[],signalSelectFilters:[],hoveredRegions:[],expandMode:1},_this}return _inherits(EEGBrowser,_Component),_createClass(EEGBrowser,[{key:"componentDidMount",value:function(){window.flexibility(document.documentElement)}},{key:"render",value:function(){var _this2=this,leaves=(0,_EEGData.getLeafRegions)(this.state.brain),selectRegions=function(regions){var selected=_this2.state.selected.filter(function(r){return!regions.includes(r)}).concat(regions);_this2.setState({selected:leaves.filter(function(region){return selected.includes(region)})})},unselectRegions=function(regions){_this2.setState({selected:_this2.state.selected.filter(function(r){return!regions.includes(r)})})},regionSelect=_react2.default.createElement(_RegionSelect.RegionSelect,{brain:this.state.brain,selected:this.state.selected,unselectRegions:unselectRegions,selectRegions:selectRegions,hoverRegions:function(regions){_this2.setState({hoveredRegions:regions})},onMouseLeave:function(){_this2.setState({hoveredRegions:[]})}}),mriView=_react2.default.createElement(_MRIViewer.MRIViewer,{regions:leaves,selected:this.state.selected,signalSelectFilters:this.state.signalSelectFilters,unselectRegions:unselectRegions,selectRegions:selectRegions,hoveredRegions:this.state.hoveredRegions,showMRI:this.state.expandMode>=2}),expandBarLeft=this.state.expandMode<=0?null:_react2.default.createElement("div",{className:"expand-bar",onClick:function(){return _this2.setState({expandMode:Math.max(_this2.state.expandMode-1,0)})}},_react2.default.createElement("span",{className:"expand-bar-icon"},"<")),expandBarRight=this.state.expandMode>=2?null:_react2.default.createElement("div",{className:"expand-bar",onClick:function(){return _this2.setState({expandMode:Math.min(_this2.state.expandMode+1,2)})}},_react2.default.createElement("span",{className:"expand-bar-icon"},">"));return _react2.default.createElement("div",{className:"eeg-browser"},_react2.default.createElement("div",{className:"eeg-browser-row"},_react2.default.createElement(_SignalSelectionFilter.SignalSelectionFilter,{signalSelectFilters:this.state.signalSelectFilters,selectedRegions:this.state.selected,onRemoveRegion:function(region){return unselectRegions([region])},unselectRegions:unselectRegions,setFilters:function(signalSelectFilters){return _this2.setState({signalSelectFilters:signalSelectFilters})},expandMode:this.state.expandMode,setExpandMode:function(expandMode){return _this2.setState({expandMode:expandMode})}})),_react2.default.createElement("div",{className:"eeg-browser-row"},this.state.expandMode>0?regionSelect:null,mriView,_react2.default.createElement("div",{className:"expand-bars"},expandBarLeft,expandBarRight),_react2.default.createElement(_SignalPlots.SignalPlots,{selected:this.state.selected,signalSelectFilters:this.state.signalSelectFilters})))}}]),EEGBrowser}(_react.Component);exports.default=EEGBrowser;var PromisedEEGBrowser=(0,_withPromise.withPromise)(EEGBrowser,{resolved2Props:function(res){return{brain:{type:"Inner",label:"Brain",value:res}}}}),App=function(_Component2){function App(props){_classCallCheck(this,App);var _this3=_possibleConstructorReturn(this,(App.__proto__||Object.getPrototypeOf(App)).call(this,props));return _this3.fetch=(0,_fetchWrapper.fetch)(window.loris.BaseURL+"/"+window.loris.TestName+"/ajax/GetMeta.php",{method:"GET",credentials:"include"}).then(function(res){return res.json()}),_this3}return _inherits(App,_Component2),_createClass(App,[{key:"render",value:function(){var _this4=this;return _react2.default.createElement(PromisedEEGBrowser,{runPromise:function(){return _this4.fetch}})}}]),App}(_react.Component);window.App=_react2.default.createFactory(App)},,,,,,,,,,,,function(module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Panel=function(_React$Component){function Panel(props){_classCallCheck(this,Panel);var _this=_possibleConstructorReturn(this,(Panel.__proto__||Object.getPrototypeOf(Panel)).call(this,props));return _this.state={collapsed:_this.props.initCollapsed},_this.panelClass=_this.props.initCollapsed?"panel-collapse collapse":"panel-collapse collapse in",_this.toggleCollapsed=_this.toggleCollapsed.bind(_this),_this}return _inherits(Panel,_React$Component),_createClass(Panel,[{key:"toggleCollapsed",value:function(){this.setState({collapsed:!this.state.collapsed})}},{key:"render",value:function(){var glyphClass=this.state.collapsed?"glyphicon pull-right glyphicon-chevron-down":"glyphicon pull-right glyphicon-chevron-up",panelHeading=this.props.title?React.createElement("div",{className:"panel-heading",onClick:this.toggleCollapsed,"data-toggle":"collapse","data-target":"#"+this.props.id,style:{cursor:"pointer"}},this.props.title,React.createElement("span",{className:glyphClass})):"";return React.createElement("div",{className:"panel panel-primary"},panelHeading,React.createElement("div",{id:this.props.id,className:this.panelClass,role:"tabpanel"},React.createElement("div",{className:"panel-body",style:{height:this.props.height}},this.props.children)))}}]),Panel}(React.Component);Panel.propTypes={id:React.PropTypes.string,height:React.PropTypes.string,title:React.PropTypes.string},Panel.defaultProps={initCollapsed:!1,id:"default-panel",height:"100%"},exports.default=Panel},,function(module,exports){module.exports=React},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.withPromise=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(14),_react2=_interopRequireDefault(_react);exports.withPromise=function(Wrapped){var transforms=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return function(_Component){function WithPromise(props){_classCallCheck(this,WithPromise);var _this=_possibleConstructorReturn(this,(WithPromise.__proto__||Object.getPrototypeOf(WithPromise)).call(this,props));return _this.state={resolved:!1,value:null},_this.mounted=!1,_this.mountPromise=new Promise(function(resolve){_this.resolve=resolve}),_this.mountPromise=_this.mountPromise.then(function(){return props.runPromise()}).then(function(value){_this.mounted&&_this.setState({resolved:!0,value:value})}),_this}return _inherits(WithPromise,_Component),_createClass(WithPromise,[{key:"componentWillReceiveProps",value:function(props){var _this2=this;this.mounted&&this.setState({resolved:!1}),props.runPromise().then(function(value){_this2.mounted&&_this2.setState({resolved:!0,value:value})})}},{key:"componentDidMount",value:function(){this.mounted=!0,this.resolve()}},{key:"componentWillUnmount",value:function(){this.mounted=!1}},{key:"render",value:function(){var _state=this.state,resolved=_state.resolved,value=_state.value;if(!resolved)return _react2.default.createElement("div",{className:"loading-screen"},"Loading...");var resolved2Props=transforms.resolved2Props;resolved2Props||(resolved2Props=function(resolved){return{resolved:resolved}});var passedProps=Object.assign(resolved2Props(value),this.props);return _react2.default.createElement(Wrapped,passedProps)}}]),WithPromise}(_react.Component)}},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.RegionSelect=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(14),_react2=_interopRequireDefault(_react),_EEGData=__webpack_require__(17);exports.RegionSelect=function(_Component){function RegionSelect(props){_classCallCheck(this,RegionSelect);var _this=_possibleConstructorReturn(this,(RegionSelect.__proto__||Object.getPrototypeOf(RegionSelect)).call(this,props));return _this.defaultProps={brain:{},selected:[]},_this.state={expanded:{}},_this}return _inherits(RegionSelect,_Component),_createClass(RegionSelect,[{key:"render",value:function(){var _this2=this,renderRegionElement=function(region,selected,onclick){var c=region.colorCode;return _react2.default.createElement("li",{key:region.name,className:"region-select-item --leaf "+(selected?"selected-region":"unselected-region"),onClick:function(){return onclick(region)},onMouseEnter:function(){_this2.props.hoverRegions([region])},onMouseLeave:_this2.props.onMouseLeave},_react2.default.createElement("div",{className:"region-color-code",style:{backgroundColor:"rgb("+c.r+", "+c.g+", "+c.b+")"}}),region.label)},renderRegionSelector=function(region){return _this2.props.selected.find(function(r){return r===region})?renderRegionElement(region,!0,function(r){return _this2.props.unselectRegions([r])}):renderRegionElement(region,!1,function(r){return _this2.props.selectRegions([r])})},clickPage=function(node){var expanded=_this2.state.expanded;expanded[node.label]=!expanded[node.label],_this2.setState({expanded:expanded})},renderInnerNode=function(node){var regions=(0,_EEGData.getLeafRegions)(node),contained=regions.map(function(r){return _this2.props.selected.includes(r)}).reduce(function(a,b){return a&&!!b},!0),onAllClick=function(event){event.stopPropagation(),contained?_this2.props.unselectRegions(regions):_this2.props.selectRegions(regions)},allButton=_react2.default.createElement("div",{className:"round-button",style:{display:"inline-block"},onClick:onAllClick},contained?"deselect all":"select all");return _react2.default.createElement("div",{key:node.label,className:"region-select-item-container"},_react2.default.createElement("li",{className:"region-select-item",onClick:function(){return clickPage(node)},onMouseEnter:function(){_this2.props.hoverRegions(regions)},onMouseLeave:_this2.props.onMouseLeave},_react2.default.createElement("span",{className:"glyphicon"+(_this2.state.expanded[node.label]?" glyphicon-chevron-down":" glyphicon-chevron-right")}),node.label," ",allButton),_react2.default.createElement("div",null,_this2.state.expanded[node.label]?node.value.map(renderRegionSelector):null))},renderNode=function(node){if(!node)return null;switch(node.type){case"Inner":return node.value.map(renderInnerNode);case"Leaf":return node.value.map(renderRegionSelector);default:return null}},lobeKeys=Object.keys(this.state.expanded),showCollapseAll=lobeKeys.length>0&&lobeKeys.some(function(k){return _this2.state.expanded[k]});return _react2.default.createElement("div",{className:"region-select"},_react2.default.createElement("div",{style:{marginTop:"0",marginBottom:"0",maxWidth:"100px",visibility:showCollapseAll?"visible":"hidden"},className:"round-button",onClick:function(){return _this2.setState({expanded:{}})}},"Collapse all"),_react2.default.createElement("ul",{className:"region-select-list"},renderNode(this.props.brain)))}}]),RegionSelect}(_react.Component)},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0}),exports.instantiateRegions=exports.getLeafRegions=exports.Region=exports.filterChannels=exports.Channel=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Filters=__webpack_require__(18),_fetchWrapper=__webpack_require__(19),Channel=exports.Channel=function(){function Channel(metaData){var tmin=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,tmax=arguments.length>2&&void 0!==arguments[2]?arguments[2]:60;_classCallCheck(this,Channel),this.metaData=metaData,this.tmin=tmin,this.tmax=tmax,this.hovered=!1,this.filters={},this.promise=null,this.fetched=!1}return _createClass(Channel,[{key:"fetch",value:function(){var _this=this;return this.promise?this.promise:(this.promise=(0,_fetchWrapper.fetch)(loris.BaseURL+"/"+loris.TestName+"/ajax/GetChannel.php?channelname="+this.metaData.name,{credentials:"include"}).then(function(res){return res.blob()}).then(function(blob){var reader=new FileReader;return reader.readAsArrayBuffer(blob),new Promise(function(resolve){reader.addEventListener("loadend",function(e){return resolve((e.srcElement||e.target).result)})})}).then(function(buffer){var edfDecoder=new pixpipe.EdfDecoder;edfDecoder.addInput(buffer),edfDecoder.update(),_this.originalSignal=edfDecoder.getOutput().getData();var timeSamples=_this.originalSignal.length;_this.domain=new Float32Array(timeSamples).fill(0);var tmin=_this.tmin,tmax=_this.tmax;_this.domain.forEach(function(_,i){var t=i/timeSamples;_this.domain[i]=tmin*(1-t)+tmax*t}),_this.signal=_this.originalSignal,_this.fetched=!0}),this.promise)}},{key:"applyFilter",value:function(lowPassFilterName,highPassFilterName,onfilterAppliedAfterLoad){var _this2=this;if(this.originalSignal){if(this.promise&&!this.fetched)return void this.promise.then(function(){_this2.applyFilter(lowPassFilterName,highPassFilterName),onfilterAppliedAfterLoad()});if(this.filters.low!==lowPassFilterName||this.filters.hi!==highPassFilterName){var diffFilter=new differenceequationsignal1d.DifferenceEquationSignal1D;diffFilter.enableBackwardSecondPass();var doFilterUpdate=function(coefficients,input){return coefficients?(diffFilter.setInput(input),diffFilter.setACoefficients(coefficients.a),diffFilter.setBCoefficients(coefficients.b),diffFilter.run(),void(_this2.signal=diffFilter.getOutput())):void(_this2.signal=input)};doFilterUpdate(_Filters.FILTERS[lowPassFilterName],this.originalSignal),doFilterUpdate(_Filters.FILTERS[highPassFilterName],this.signal)}}}},{key:"testSelectionFilters",value:function(filters){var _this3=this;if(0===filters.length)return!0;var matches={};return filters.forEach(function(filter){return"hemisphere"===filter.key&&"Both"===filter.value?void(matches[filter.key]=!0):"electrodeType"===filter.key&&"all"===filter.value?void(matches[filter.key]=!0):"oneCPPPR"===filter.key&&"false"===filter.value?void(matches[filter.key]=!0):void(matches[filter.key]=matches[filter.key]||String(_this3.metaData[filter.key])===filter.value)}),Object.keys(matches).every(function(key){return matches[key]})}}]),Channel}(),colorMapper=new pixpipe.Colormap;colorMapper.setStyle("jet"),colorMapper.buildLut(39);var Region=(exports.filterChannels=function(filters,regions){return regions.map(function(r){return r.channels.filter(function(channel){return channel.testSelectionFilters(filters)})}).reduce(function(a,b){return b.concat(a)},[])},exports.Region=function Region(name,channelMetas){var _this4=this;if(_classCallCheck(this,Region),this.name=name,this.label=name,this.colorCode={r:0,g:0,b:0},this.regionID=channelMetas[0]?channelMetas[0].regionID:null,this.regionID){var color=colorMapper.getLutAt(this.regionID);this.colorCode={r:color[0],g:color[1],b:color[2]}}this.channels=channelMetas.map(function(channel){return new Channel(channel)}),this.channels.forEach(function(c){c.colorCode=_this4.colorCode})});exports.getLeafRegions=function getLeafRegions(node){switch(node.type){case"Inner":return node.value.map(getLeafRegions).reduce(function(list,next){return list.concat(next)});case"Leaf":return node.value}return[]},exports.instantiateRegions=function instantiateRegions(node){var path=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return node.value.length>0&&"Leaf"===node.value[0].type?(node.type="Leaf",void(node.value=node.value.map(function(region){var label=path[0].label+" "+region.label;return region.value.forEach(function(channel){channel.oneCPPPR=String(channel.oneCPPPR),channel.position=(new THREE.Vector3).fromArray(channel.position)}),new Region(label,region.value)}))):void node.value.forEach(function(node){return instantiateRegions(node,path.concat([node]))})}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.LOW_PASS_FILTERS=[{key:"none",label:"No Low Pass Filter"},{key:"lopass15",label:"Low Pass 15Hz"},{key:"lopass20",label:"Low Pass 20Hz"},{key:"lopass30",label:"Low Pass 30Hz"},{key:"lopass40",label:"Low Pass 40Hz"}],exports.HIGH_PASS_FILTERS=[{key:"none",label:"No High Pass Filter"},{key:"hipass0_5",label:"High Pass 0.5Hz"},{key:"hipass1",label:"High Pass 1Hz"},{key:"hipass5",label:"High Pass 5Hz"},{key:"hipass10",label:"High Pass 10Hz"}],exports.FILTERS={lopass15:{b:[.080716994603448,.072647596309189,.080716994603448],a:[1,-1.27986023820987,.527812029663189]},lopass20:{b:[.113997925584386,.149768961515167,.113997925584386],a:[1,-1.036801335341888,.43695012041825]},lopass30:{b:[.192813914343002,.325725940431161,.192813914343002],a:[1,-.570379950222695,.323884080078956]},lopass40:{b:[.281307434361307,.517866041871659,.281307434361307],a:[1,-.135289362582513,.279792792112445]},hipass0_5:{b:[.937293010134975,-1.874580964130496,.937293010134975],a:[1,-1.985579602684723,.985739491853153]},hipass1:{b:[.930549324176904,-1.861078566912498,.930549324176904],a:[1,-1.971047525054235,.971682555986628]},hipass5:{b:[.877493430773021,-1.754511635757187,.877493430773021],a:[1,-1.851210698908115,.866238657864428]},hipass10:{b:[.81345216101175,-1.625120853023986,.81345216101175],a:[1,-1.694160769645868,.750559011393507]}}},function(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.fetch=function(){var _window,fourohfoured=!1,twoohfoured=!1;return(_window=window).fetch.apply(_window,arguments).then(function(res){switch(res.status){case 401:return void window.location.assign(window.loris.BaseURL);case 404:if(fourohfoured)return;return alert("The hosted EDF files data could not be found."),void(fourohfoured=!0);case 204:if(twoohfoured)return;return alert("The client is sending incorectly formatted file requests."),void(twoohfoured=!0);default:return res}})}},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.MRIViewer=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(14),_react2=_interopRequireDefault(_react),_MRILoader=__webpack_require__(21),_MRILoader2=_interopRequireDefault(_MRILoader),_PlaneShifter=__webpack_require__(25),MESH_SIZE=1/80,WHITE=16777215,GRAY=3355443,BLUE=4359668;exports.MRIViewer=function(_Component){function MRIViewer(props){_classCallCheck(this,MRIViewer);var _this=_possibleConstructorReturn(this,(MRIViewer.__proto__||Object.getPrototypeOf(MRIViewer)).call(this,props));return _this.state={showElectrodes:!1,position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}},_this.mouse=new THREE.Vector2,_this.rayCaster=new THREE.Raycaster,_this.selectRegionAtMouse=_this.selectRegionAtMouse.bind(_this),_this.displacementFromRegion=new THREE.Vector3,_this}return _inherits(MRIViewer,_Component),_createClass(MRIViewer,[{key:"selectRegionAtMouse",value:function(event){var _this2=this;if(2===event.button&&(event.preventDefault(),this.camera&&this.mriLoader.system)){this.rayCaster.setFromCamera(this.mouse,this.camera);var intersects=this.rayCaster.intersectObjects(this.mriLoader.system.children);if(0!==intersects.length){var hitPoint=intersects[0].point,minDistance=-(1/0),minRegion=void 0;return this.props.regions.forEach(function(region,i){region.channels.forEach(function(channel){_this2.displacementFromRegion.subVectors(channel.metaData.position,hitPoint);var distance=_this2.displacementFromRegion.length();(!minRegion||minDistance>distance)&&(minRegion=region,minDistance=distance)})}),this.props.selected.find(function(r){return r===minRegion})?void this.props.unselectRegions([minRegion]):void this.props.selectRegions([minRegion])}}}},{key:"componentWillReceiveProps",value:function(newProps){var _this3=this;if(!this.initialized&&!this.props.showMRI&&newProps.showMRI){var _run=function _run(){renderer.render(self.scene,self.camera),window.requestAnimationFrame(_run)};this.initialized=!0;var width=440,height=440,renderer=new THREE.WebGLRenderer;renderer.setClearColor(new THREE.Color(1,1,1,1));var self=this;this.canvas=renderer.domElement,this.canvas.addEventListener("mousemove",function(event){var _self$canvas$getBound=self.canvas.getBoundingClientRect(),top=_self$canvas$getBound.top,left=_self$canvas$getBound.left,width=_self$canvas$getBound.width,height=_self$canvas$getBound.height,x=event.clientX-left,y=height-(event.clientY-top);self.mouse.set(2*x/width-1,2*y/height-1)}),this.canvas.width=width,this.canvas.height=height,this.addCanvas(),renderer.setSize(width,height),this.camera=new THREE.PerspectiveCamera(45,width/height,1,1e5),this.camControls=new THREE.OrbitControls(this.camera,this.canvas),this.camControls.enableKeys=!1,delete this.camControls.mouseButtons.PAN,this.scene=new THREE.Scene,this.mriLoader=new _MRILoader2.default(this.scene),this.meshes=[],this.mriLoader.initialize().then(function(){_this3.planeShifter=new _PlaneShifter.PlaneShifter(_this3.mriLoader.system,_this3.camera,{controls:_this3.camControls,mouse:_this3.mouse}),_this3.planeShifter.setBoundingBox(_this3.mriLoader.getShaderManager().getBoundingBox());var round=function(x){return Math.floor(100*x)/100};_this3.planeShifter.on("translation",function(){var _mriLoader$system$pos=_this3.mriLoader.system.position,x=_mriLoader$system$pos.x,y=_mriLoader$system$pos.y,z=_mriLoader$system$pos.z;x=round(x),y=round(y),z=round(z),_this3.setState({position:{x:x,y:y,z:z}})}),_this3.planeShifter.on("rotation",function(){var _mriLoader$system$rot=_this3.mriLoader.system.rotation,x=_mriLoader$system$rot.x,y=_mriLoader$system$rot.y,z=_mriLoader$system$rot.z,toDeg=function(rad){return rad/Math.PI*180};x=round(toDeg(x)),y=round(toDeg(y)),z=round(toDeg(z)),_this3.setState({rotation:{x:x,y:y,z:z}})});var dimensions=_this3.mriLoader.getShaderManager().getDimensions(),x=dimensions.x,y=dimensions.y,z=dimensions.z,scale=Math.min(x,y,z)/2,diagonal=dimensions.length();_this3.camera.position.z=diagonal/1.5,_this3.camera.lookAt(new THREE.Vector3(0,0,0));var material=new THREE.MeshBasicMaterial({color:GRAY}),geometry=new THREE.SphereBufferGeometry(MESH_SIZE*scale,8,8);_this3.props.regions.forEach(function(region,i){region.channels.forEach(function(channel){var mesh=new THREE.Mesh(geometry,new THREE.MeshBasicMaterial);mesh.material.copy(material),mesh.position.copy(channel.metaData.position),mesh.visible=_this3.state.showElectrodes,_this3.scene.add(mesh),_this3.meshes[i]||(_this3.meshes[i]=[]),_this3.meshes[i].push(mesh)})})}),_run()}}},{key:"setVisibility",value:function(){var _this4=this;this.props.regions.forEach(function(region,i){region.channels.forEach(function(channel){_this4.meshes[i]&&_this4.meshes[i].forEach(function(mesh){mesh.visible=_this4.state.showElectrodes})})})}},{key:"componentDidUpdate",value:function(){var _this5=this;this.addCanvas(),this.initialized&&(this.setVisibility(),this.props.regions.forEach(function(region,i){region.channels.forEach(function(channel){_this5.meshes[i]&&(_this5.meshes[i].forEach(function(m){m.material.color.setHex(GRAY)}),_this5.props.selected.find(function(r){return r===region})&&_this5.meshes[i].forEach(function(m){m.material.color.setHex(WHITE)}),_this5.props.hoveredRegions.includes(region)&&_this5.meshes[i].forEach(function(m){m.material.color.setHex(BLUE)}))})}))}},{key:"addCanvas",value:function(){this.container&&this.lastContainer!==this.container&&(this.container.appendChild(this.canvas),this.lastContainer=this.container)}},{key:"render",value:function(){var _this6=this;if(this.props.showMRI){var changePos=function(_ref){var x=_ref.x,y=_ref.y,z=_ref.z;if(_this6.mriLoader.system){var position={x:void 0===x?_this6.state.position.x:Number(x),y:void 0===y?_this6.state.position.y:Number(y),z:void 0===z?_this6.state.position.z:Number(z)};_this6.mriLoader.system.position.set(position.x,position.y,position.z),_this6.setState({position:position})}},toRad=function(deg){return Number(deg)/180*Math.PI},changeRot=function(_ref2){var x=_ref2.x,y=_ref2.y,z=_ref2.z;if(_this6.mriLoader.system){var rotation={x:void 0===x?_this6.state.rotation.x:x,y:void 0===y?_this6.state.rotation.y:y,z:void 0===z?_this6.state.rotation.z:z
};_this6.mriLoader.system.rotation.set(toRad(rotation.x),toRad(rotation.y),toRad(rotation.z)),_this6.setState({rotation:rotation})}};return _react2.default.createElement("div",{className:"mri-view-container"},_react2.default.createElement("div",{className:"mri-view-canvas-container",onMouseDown:this.selectRegionAtMouse,ref:function(div){_this6.container=div}}),_react2.default.createElement("div",{className:"mri-controls"},_react2.default.createElement("h6",null,"While dragging with the mouse, hold R to rotate planes and hold T to translate planes.")),_react2.default.createElement("div",{className:"mri-controls"},_react2.default.createElement("div",{style:{width:"150px",alignSelf:"center"},className:"round-button",onClick:function(){_this6.setState({showElectrodes:!_this6.state.showElectrodes})}},this.state.showElectrodes?"Hide":"Show"," Electrodes")),_react2.default.createElement("div",{className:"mri-controls"},_react2.default.createElement("div",{style:{width:"150px",alignSelf:"center"},className:"round-button",onClick:function(){changeRot({x:0,y:0,z:0}),changePos({x:0,y:0,z:0})}},"Reset planes")))}return null}}]),MRIViewer}(_react.Component)},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_ShaderManager=__webpack_require__(22),_ShaderManager2=_interopRequireDefault(_ShaderManager),_MRIOverlay=__webpack_require__(24),_MRIOverlay2=_interopRequireDefault(_MRIOverlay),MODEL_URL=window.loris.BaseURL+"/"+window.loris.TestName+"/static/model_mni.nii.gz",LABEL_URL=window.loris.BaseURL+"/"+window.loris.TestName+"/static/labels_mni.nii.gz",MRILoader=function(){function MRILoader(scene){_classCallCheck(this,MRILoader),this.scene=scene,this.shaderManager=new _ShaderManager2.default,this.colorMapper=new pixpipe.Colormap,this.colorMapper.setStyle("jet"),this.colorMapper.buildLut(39)}return _createClass(MRILoader,[{key:"initialize",value:function(){var _this=this,promise=this.loadFromURL(MODEL_URL).then(function(){return _this.loadFromURL(LABEL_URL)}).then(function(){var colorMap=_this.colorMapper.createHorizontalLutImage(!1).getData(),texture=new THREE.DataTexture(new Uint8Array(colorMap),colorMap.length/3,1,THREE.RGBFormat);texture.needsUpdate=!0,_this.shaderManager.setArrayUniform("colorMap",1,texture),_this.shaderManager.setArrayUniform("enableColorMap",1,1),_this.createMRIPlanes()});return promise}},{key:"getShaderManager",value:function(){return this.shaderManager}},{key:"loadFromURL",value:function(url){var url2buf=new pixpipe.UrlToArrayBufferReader;url2buf.addInput(url),url2buf.update();var self=this;return new Promise(function(resolve){url2buf.on("ready",function(){var buffer=this.getOutput(),genericDecoder=new pixpipe.Image3DGenericDecoderAlt;if(genericDecoder.addInput(buffer),genericDecoder.update(),!genericDecoder.getNumberOfOutputs())return void console.warn("No output from generic decoder.");var mniVolume=genericDecoder.getOutput();return mniVolume?(self.shaderManager.addOverlay(new _MRIOverlay2.default(url,mniVolume)),void resolve(self.shaderManager)):void console.warn("Non-existant output for genericDecoder.")})})}},{key:"createMRIPlanes",value:function(){this.system=new THREE.Object3D;var plane=new THREE.Mesh;this.shaderManager.shadePlane(plane),this.system.add(plane),plane=new THREE.Mesh,plane.rotation.y=Math.PI/2,this.shaderManager.shadePlane(plane),this.system.add(plane),plane=new THREE.Mesh,this.shaderManager.shadePlane(plane),plane.rotation.x=Math.PI/2,this.system.add(plane),this.scene.add(this.system)}}]),MRILoader}();exports.default=MRILoader},function(module,exports,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_Shaders=__webpack_require__(23),compareVecs=function(comp){return function(a1,a2){if(a1.length!==a2.length)throw new Error(a1+" and "+a2+" are not equal length");var out=[];return a1.forEach(function(_,i){out[i]=comp(a1[i],a2[i])}),out}},ZERO_VEC_ARRAY=[0,0,0],DEFAULT_SHADER="\n  void main() {\n    discard;\n  }\n",ShaderManager=function(){function ShaderManager(){_classCallCheck(this,ShaderManager),this.material=new THREE.ShaderMaterial({fragmentShader:DEFAULT_SHADER}),this.onResetCallbacks=[],this.box=new THREE.Box3,this.overlayMRIBuffers=[],this.uniforms={trilinearInterpol:{type:"b",value:!1},contrastTexture:{type:"t",value:null},enableConstrast:{type:"b",value:!1},brightness:{type:"f",value:-1},worldMin:{type:"3fv",value:ZERO_VEC_ARRAY},worldMax:{type:"3fv",value:ZERO_VEC_ARRAY},w2v:{type:"Matrix4fv",value:[]},swapMat:{type:"Matrix3fv",value:[]},stride:{type:"3fv",value:[]},dimensions:{type:"3fv",value:[]},weight:{type:"1fv",value:[]},timeIndex:{type:"1fv",value:[]},timeStride:{type:"1fv",value:[]},nbTexturesUsed:{type:"1iv",value:[]},textureSize:{type:"2fv",value:[]},textures:{type:"tv",value:[]},colorMap:{type:"tv",value:[]},enableColorMap:{type:"1iv",value:[]},textureOffsets:{type:"1iv",value:[]}}}return _createClass(ShaderManager,[{key:"getMRIs",value:function(){return this.overlayMRIBuffers}},{key:"getDimensions",value:function(){return this.dimensions||new THREE.Vector3}},{key:"getBoundingBox",value:function(){return this.box}},{key:"addOverlay",value:function(mriOverlay){this.overlayMRIBuffers.push(mriOverlay),this.resetShader()}},{key:"removeOverlay",value:function(index){this.overlayMRIBuffers.splice(index,1),this.resetShader()}},{key:"resetShader",value:function(){var bs=this.overlayMRIBuffers.map(function(b){return b.getUniforms()});this.uniforms.worldMin.value=bs.map(R.prop("worldMin")).reduce(compareVecs(function(x1,x2){return x1<x2?x1:x2}),ZERO_VEC_ARRAY),this.uniforms.worldMax.value=bs.map(R.prop("worldMax")).reduce(compareVecs(function(x1,x2){return x1>x2?x1:x2}),ZERO_VEC_ARRAY);var v1=(new THREE.Vector3).fromArray(this.uniforms.worldMin.value),v2=(new THREE.Vector3).fromArray(this.uniforms.worldMax.value);if(this.dimensions=(new THREE.Vector3).subVectors(v2,v1),this.box.copy(new THREE.Box3(v1,v2)),0===bs.length)return this.material.fragmentShader=DEFAULT_SHADER,this.material.needsUpdate=!0,void this.onResetCallbacks.forEach(function(f){f()});this.uniforms.w2v.value=R.flatten(bs.map(R.prop("w2v"))),this.uniforms.swapMat.value=R.flatten(bs.map(R.prop("swapMat"))),this.uniforms.stride.value=R.flatten(bs.map(R.prop("stride"))),this.uniforms.dimensions.value=R.flatten(bs.map(R.prop("dimensions"))),this.uniforms.weight.value=bs.map(R.prop("weight")),this.uniforms.timeIndex.value=bs.map(R.prop("timeIndex")),this.uniforms.timeStride.value=bs.map(R.prop("timeStride")),this.uniforms.nbTexturesUsed.value=bs.map(R.prop("nbTexturesUsed")),this.uniforms.textureSize.value=R.flatten(bs.map(R.prop("textureSize"))),this.uniforms.textures.value=R.unnest(bs.map(R.prop("textures"))),this.uniforms.colorMap.value=bs.map(R.prop("colorMap")),this.uniforms.enableColorMap.value=bs.map(R.prop("enableColorMap")),this.uniforms.textureOffsets.value=[];for(var offset=0,i=0;i<this.uniforms.nbTexturesUsed.value.length;i+=1)this.uniforms.textureOffsets.value[i]=offset,offset+=this.uniforms.nbTexturesUsed.value[i];this.material.copy(new THREE.ShaderMaterial({side:THREE.DoubleSide,transparent:!0,uniforms:this.uniforms,vertexShader:_Shaders.VERTEX,fragmentShader:(0,_Shaders.FRAGMENT)(this.uniforms.textures.value.length,this.uniforms.textureOffsets.value.length)})),this.material.needsUpdate=!0,this.onResetCallbacks.forEach(function(f){f()})}},{key:"onReset",value:function(callback){callback instanceof Function&&this.onResetCallbacks.push(callback)}},{key:"shadePlane",value:function(plane){if(this.material){var planeSize=2*this.getDimensions().length();plane.material=this.material,plane.geometry=new THREE.PlaneGeometry(planeSize,planeSize),plane.needsUpdate=!0}}},{key:"setUniform",value:function(key,value){var matUniform=R.path(["uniforms",key],this.material);matUniform&&(matUniform.value=value),this.uniforms[key]?this.uniforms[key].value=value:this.uniforms[key]={value:value}}},{key:"setArrayUniform",value:function(key,index,value){var matUniform=R.path(["uniforms",key],this.material);matUniform&&matUniform.value instanceof Array&&(matUniform.value[index]=value),this.uniforms[key]&&this.uniforms[key].value instanceof Array&&(this.uniforms[key].value=R.adjust(R.always(value),index,this.uniforms[key].value),this.overlayMRIBuffers[index]&&(this.overlayMRIBuffers[index].getUniforms()[key]=value))}},{key:"getMaterial",value:function(){return this.material}}]),ShaderManager}();exports.default=ShaderManager},function(module,exports){"use strict";function loopIfsFragColor(min,max){for(var code="",i=min;i<max;i++)code+="\n    {\n      gl_FragColor += colors["+i+"];\n    }\n    ";return code}function loopIntensityWorld(min,max){for(var code="",i=min;i<max;i++)code+="\n      {\n        vec3 voxelPos = swapMat["+i+"] * (w2v["+i+"] * worldCoord).xyz;\n        voxelPos = floor(voxelPos);\n        float intensity = getIntensityWorldNearest(\n          voxelPos,\n          dimensions["+i+"],\n          stride["+i+"],\n          timeIndex["+i+"],\n          timeStride["+i+"],\n          textureOffsets["+i+"],\n          nbTexturesUsed["+i+"]\n        );\n        if (intensity > maxIntensity) {\n          maxIntensity = intensity;\n        }\n        colors["+i+"].rgb = texture2D(colorMap["+i+"], vec2(intensity, 0.5)).rgb;\n        if (!(enableColorMap["+i+"] == 1 && intensity >= EPSILON))\n        {\n          colors["+i+"] = vec4(intensity, intensity, intensity, 1.0);\n        } else {\n          colors["+i+"].a = 1.0;\n        }\n        if (brightness >= 0.0)\n        {\n          colors["+i+"].rgb = clamp(colors["+i+"].rgb * brightness, 0.0, 1.0);\n        }\n        colors["+i+"] *= weight["+i+"];\n      }\n    ";return code}function loopIntensityWorldNearest(min,max){for(var code="",i=min;i<max;i++)code+="\n      {\n        if ("+i+" >= textureOffset && "+i+" < textureOffset + nbTexturesUsed)\n        {\n          float bufferSize = floor(textureSize["+i+"].x * textureSize["+i+"].y);\n          if (outOfBounds(voxelPos, vec3(0.0, 0.0, 0.0), dimensions))\n          {\n            skipped += bufferSize;\n          }\n          float offset = floor(dot(voxelPos, stride));\n          offset += timeIndex * timeStride;\n          offset -= skipped;\n          vec2 tex;\n          tex.x = mod(offset, textureSize["+i+"].x) + 0.5;\n          tex.y = floor(offset / textureSize["+i+"].x) + 0.5;\n          tex = tex / textureSize["+i+"];\n          vec4 color = texture2D(textures["+i+"], tex);\n          if (!(outOfBounds(voxelPos, vec3(0.0, 0.0, 0.0), dimensions))) {\n            return color.r;\n          }\n        }\n      }\n    ";return code}Object.defineProperty(exports,"__esModule",{value:!0});exports.VERTEX="\n  precision highp float;\n\n  varying vec4 worldCoord;\n\n  void main( void )\n  {\n    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = projectionMatrix * mvPosition;\n    worldCoord = modelMatrix * vec4( position, 1.0 );\n  }\n",exports.FRAGMENT=function(nbTextures,numMRIs){return"\n  precision highp float;\n\n\n  // Use trinlinear interpolation\n  uniform bool trilinearInterpolation;\n\n  // texture that represent the curve data to look up\n  uniform sampler2D contrastTexture;\n\n  // enable contrast curve\n  uniform bool enableConstrast;\n\n  // brightness factor of the voxels\n  uniform float brightness;\n\n  // voxel -> world and world -> voxel transforms\n  uniform vec3 worldMin;\n  uniform vec3 worldMax;\n  uniform mat4 w2v["+numMRIs+"];\n  uniform mat3 swapMat["+numMRIs+"];\n  uniform vec3 stride["+numMRIs+"];\n  uniform vec3 dimensions["+numMRIs+"];\n\n  // sampling weights\n  uniform float weight["+numMRIs+"];\n\n  // Time index and stride for fMRI\n  uniform float timeIndex["+numMRIs+"];\n  uniform float timeStride["+numMRIs+"];\n\n  // number of textures used, and texture array offset of the volumes\n  uniform int nbTexturesUsed["+numMRIs+"];\n  uniform int textureOffsets["+numMRIs+"];\n\n  // buffer sizes and textures array containing all the volumetric data.\n  uniform vec2 textureSize["+nbTextures+"];\n  uniform sampler2D textures["+nbTextures+"];\n\n  // color map textures\n  uniform sampler2D colorMap["+numMRIs+"];\n\n  // enable color maps\n  uniform int enableColorMap["+numMRIs+"];\n\n  // interpolated fragment values\n  varying vec4 worldCoord;\n\n  bool outOfBounds(vec3 pos, vec3 minCoord, vec3 maxCoord)\n  {\n    return (\n      (pos.x <= minCoord.x) || (pos.x >= maxCoord.x) ||\n      (pos.y <= minCoord.y) || (pos.y >= maxCoord.y) ||\n      (pos.z <= minCoord.z) || (pos.z >= maxCoord.z)\n    );\n  }\n\n  float getIntensityWorldNearest(\n    vec3 voxelPos,\n    vec3 dimensions,\n    vec3 stride,\n    float timeIndex,\n    float timeStride,\n    int textureOffset,\n    int nbTexturesUsed\n  )\n  {\n\n    float skipped = 0.0;\n"+loopIntensityWorldNearest(0,nbTextures)+"\n    return -1.0;\n  }\n  const float EPSILON = 0.06;\n  // return the color corresponding to the given shifted world cooridinates\n  // using a neirest neighbors approx (no interpolation)\n  void getIntensityWorld(inout vec4 colors["+numMRIs+"], vec4 worldCoord)\n  {\n    float maxIntensity = -1.0;\n"+loopIntensityWorld(0,numMRIs)+"\n    if (maxIntensity < 0.0) {\n      discard;\n    }\n  }\n\n  void main( void )\n  {\n    if (outOfBounds(worldCoord.xyz, worldMin, worldMax))\n    {\n      discard;\n      return;\n    }\n\n    // interpolation or not\n    vec4 colors["+numMRIs+"];\n    getIntensityWorld(colors, worldCoord);\n\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n"+loopIfsFragColor(0,numMRIs)+"\n    gl_FragColor  = clamp(gl_FragColor, 0.0, 1.0);\n  }\n"}},function(module,exports){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function makeGLTextureViews(data){for(var gl=document.createElement("canvas").getContext("experimental-webgl"),maxTexSize=gl.getParameter(gl.MAX_TEXTURE_SIZE),maxVoxels=maxTexSize*maxTexSize,nbTexturesUsed=Math.ceil(data.length/maxVoxels),textureSize=new Array(nbTexturesUsed),textures=new Array(nbTexturesUsed),i=0;i<nbTexturesUsed;i+=1){textureSize[i]=[maxTexSize,maxTexSize],i>=nbTexturesUsed-1&&(textureSize[i][1]=Math.ceil(data.length/maxTexSize),textureSize[i][1]<=1?textureSize[i][0]=Math.ceil(data.length%maxTexSize):textureSize[i][0]=maxTexSize);for(var texdata=new Uint8Array(textureSize[i][0]*textureSize[i][1]).fill(0),j=0;j<texdata.length;j+=1)texdata[j]=data[i*maxVoxels+j];textures[i]=new THREE.DataTexture(texdata,textureSize[i][0],textureSize[i][1],THREE.LuminanceFormat),textures[i].needsUpdate=!0}return{textures:textures,textureSize:textureSize,nbTexturesUsed:nbTexturesUsed}}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),MRIOverlay=function(){function MRIOverlay(name,image3d){_classCallCheck(this,MRIOverlay),this.name=name,this.image3d=image3d,this.colorMapName=null,this.weight=1,this.timeIndex=0;var timeDim=image3d.getMetadata("dimensions").find(function(d){return"t"===d.nameWorldSpace});this.maxTimeIndex=timeDim?timeDim.length-1:0;var _makeGLTextureViews=makeGLTextureViews(image3d.getDataUint8()),textures=_makeGLTextureViews.textures,textureSize=_makeGLTextureViews.textureSize,nbTexturesUsed=_makeGLTextureViews.nbTexturesUsed,_image3d$getTransfoBo=image3d.getTransfoBox("v2w"),min=_image3d$getTransfoBo.min,max=_image3d$getTransfoBo.max;this.uniforms={worldMin:[min.x,min.y,min.z],worldMax:[max.x,max.y,max.z],w2v:image3d.getMetadata("transformations").w2v,swapMat:image3d.getVoxelCoordinatesSwapMatrix(!0),stride:image3d.getMetadata("dimensions").map(R.prop("stride")).slice(0,3).reverse(),dimensions:image3d.getMetadata("dimensions").map(R.prop("length")).slice(0,3).reverse(),weight:this.weight,timeIndex:this.timeIndex,timeStride:timeDim?timeDim.stride:0,nbTexturesUsed:nbTexturesUsed,textureSize:textureSize,textures:textures,colorMap:null,enableColorMap:0}}return _createClass(MRIOverlay,[{key:"getColormapName",value:function(){return this.colorMapName}},{key:"setColormapName",value:function(name){this.colorMapName=name}},{key:"getWeight",value:function(){return this.weight}},{key:"setWeight",value:function(weight){this.weight=weight}},{key:"getTimeIndex",value:function(){return this.timeIndex}},{key:"setTimeIndex",value:function(timeIndex){this.timeIndex=timeIndex}},{key:"getMaxTime",value:function(){return this.maxTimeIndex}},{key:"getName",value:function(){return this.name}},{key:"getImage3D",value:function(){return this.image3d}},{key:"getUniforms",value:function(){return this.uniforms}}]),MRIOverlay}();exports.default=MRIOverlay},function(module,exports,__webpack_require__){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!function(global,factory){"object"===_typeof(exports)&&"undefined"!=typeof module?factory(exports):(__WEBPACK_AMD_DEFINE_ARRAY__=[exports],__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}(void 0,function(exports){"use strict";var TROIS=null,PlaneShifter=function(){function PlaneShifter(planeContainer,camera){var options=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};_classCallCheck(this,PlaneShifter),this._requireThree(),this._enabled=!0,this._planeContainer=planeContainer,this._camera=camera,this._controls=this._getOption(options,"controls",null),this._mouse=this._getOption(options,"mouse",new TROIS.Vector2(1/0,1/0)),this._useReferenceMouse=!!options.mouse,this._pointClicked3D=null,this._pointClicked2D=null,this._raycaster=new TROIS.Raycaster,this._cameraFollowObject=!1,this._keyPressed={},this._originalDistanceToCam=this._camera.position.clone().sub(this._planeContainer.position).length(),this._boundingBox=new TROIS.Box3(new TROIS.Vector3(-(1/0),-(1/0),-(1/0)),new TROIS.Vector3(1/0,1/0,1/0)),this._rotateConfig={},this._shiftConfig={},this._states={IDLE:0,TRANSLATION:1,ROTATION:2},this._activeState=this._states.IDLE;var rotationKey=this._getOption(options,"rotationKey","KeyR"),translationKey=this._getOption(options,"rotationKey","KeyT");this._keysStates={},this._keysStates[rotationKey]=this._states.ROTATION,this._keysStates[translationKey]=this._states.TRANSLATION,this._initNormals(),this._initEvents(),this._customEvents={startInteraction:[],stopInteraction:[],rotation:[],translation:[]}}return _createClass(PlaneShifter,[{key:"_requireThree",value:function(){try{TROIS=window&&window.THREE||__webpack_require__(!function(){var e=new Error('Cannot find module "three"');throw e.code="MODULE_NOT_FOUND",e}())}catch(e){try{TROIS=__webpack_require__(!function(){var e=new Error('Cannot find module "three"');throw e.code="MODULE_NOT_FOUND",e}())}catch(e){console.error(e)}}}},{key:"_getOption",value:function(optionsObject,key,defaultValue){return optionsObject?optionsObject[key]||defaultValue:defaultValue}},{key:"setBoundingBox",value:function(b){this._boundingBox=b.clone()}},{key:"_initNormals",value:function(){this._planeContainer.children.forEach(function(plane){plane.userData.normalV=new TROIS.Vector3(0,0,1).applyQuaternion(plane.quaternion).normalize()})}},{key:"_initEvents",value:function(){window.addEventListener("mousemove",this._onMouseMove.bind(this),!1),window.addEventListener("mousedown",this._onMouseDown.bind(this),!1),window.addEventListener("mouseup",this._onMouseUp.bind(this),!1),window.addEventListener("keyup",this._onKeyUp.bind(this),!1),window.addEventListener("keydown",this._onKeyDown.bind(this),!1)}},{key:"_onMouseMove",value:function(evt){this._enabled&&(this._useReferenceMouse||(this._mouse.x=evt.clientX/window.innerWidth*2-1,this._mouse.y=2*-(evt.clientY/window.innerHeight)+1),this._followInteraction())}},{key:"_onMouseDown",value:function(evt){this._enabled&&(this._keyPressed.mouse=!0,this._activeState!=this._states.IDLE&&this._raycast())}},{key:"_onMouseUp",value:function(evt){this._enabled&&(this._keyPressed.mouse=!1,this._interacting=!1)}},{key:"_isKeyPressed",value:function(keycode){return keycode in this._keyPressed&&this._keyPressed[keycode]}},{key:"_onKeyUp",value:function(evt){this._enabled&&(this._keyPressed[evt.code]=!1,this._evaluateCurentState())}},{key:"_onKeyDown",value:function(evt){this._enabled&&(this._keyPressed[evt.code]=!0,this._evaluateCurentState())}},{key:"_evaluateCurentState",value:function(){var previousState=this._activeState;this._activeState=this._states.IDLE;for(var listOfKeys=Object.keys(this._keysStates),i=0;i<listOfKeys.length;i++)if(listOfKeys[i]in this._keyPressed&&this._keyPressed[listOfKeys[i]]){this._activeState=this._keysStates[listOfKeys[i]];break}previousState!=this._activeState&&(this._activeState==this._states.IDLE?(this._enableControl(),this._triggerEvents("stopInteraction")):(this._disableControl(),this._triggerEvents("startInteraction")))}},{key:"setCameraFollowObject",value:function(b){this._cameraFollowObject=b}},{key:"_getScreenCoord",value:function(coord3D){var tempVector=coord3D.clone();return tempVector.project(this._camera),new TROIS.Vector2(tempVector.x,tempVector.y)}},{key:"_raycast",value:function(){this._raycaster.setFromCamera(this._mouse,this._camera);for(var intersects=this._raycaster.intersectObject(this._planeContainer,!0),i=0;i<intersects.length;i++)if(this._boundingBox.containsPoint(intersects[i].point)){switch(this._activeState){case this._states.TRANSLATION:this._castedRayForTranslation(intersects[i]);break;case this._states.ROTATION:this._castedRayForRotation(intersects[i])}break}}},{key:"_castedRayForTranslation",value:function(intersect){this._interacting=!0;var intersectPlane=intersect.object;this._shiftConfig.originalObjectPosition=this._planeContainer.position.clone(),this._shiftConfig.hitPoint3D=intersect.point.clone(),this._shiftConfig.hitPoint2D=this._mouse.clone(),this._shiftConfig.planeNormalInternal3D=intersectPlane.userData.normalV.clone(),this._shiftConfig.planeNormalWorld3D=intersectPlane.userData.normalV.clone().applyQuaternion(this._planeContainer.quaternion).normalize(),this._shiftConfig.topPoint3D=this._shiftConfig.hitPoint3D.clone().add(this._shiftConfig.planeNormalWorld3D),this._shiftConfig.topPoint2D=this._getScreenCoord(this._shiftConfig.topPoint3D),this._shiftConfig.planeNormal2D=new TROIS.Vector2(this._shiftConfig.topPoint2D.x-this._shiftConfig.hitPoint2D.x,this._shiftConfig.topPoint2D.y-this._shiftConfig.hitPoint2D.y),this._shiftConfig.hitPoint3DInternal=this._planeContainer.worldToLocal(intersect.point.clone())}},{key:"_followInteraction",value:function(){if(this._interacting)switch(this._activeState){case this._states.TRANSLATION:this._followTranslation();break;case this._states.ROTATION:this._followRotation()}}},{key:"_followTranslation",value:function(){var mouseShift=new TROIS.Vector2(this._mouse.x-this._shiftConfig.hitPoint2D.x,this._mouse.y-this._shiftConfig.hitPoint2D.y),normal2DLengthOnScreen=(this._camera.position.clone().sub(this._planeContainer.position).length(),this._shiftConfig.planeNormal2D.length()),normalFactor=mouseShift.dot(this._shiftConfig.planeNormal2D.clone().normalize())/normal2DLengthOnScreen,shift3D=this._shiftConfig.planeNormalWorld3D.clone().multiplyScalar(normalFactor),newPosition=new TROIS.Vector3(this._shiftConfig.originalObjectPosition.x+shift3D.x,this._shiftConfig.originalObjectPosition.y+shift3D.y,this._shiftConfig.originalObjectPosition.z+shift3D.z);this._boundingBox.containsPoint(newPosition)&&(this._planeContainer.position.set(this._shiftConfig.originalObjectPosition.x+shift3D.x,this._shiftConfig.originalObjectPosition.y+shift3D.y,this._shiftConfig.originalObjectPosition.z+shift3D.z),this._triggerEvents("translation")),this._cameraFollowObject&&this._camera.lookAt(this._planeContainer.position)}},{key:"_disableControl",value:function(){this._controls&&(this._controls.enabled&&this._saveOrbitData(),this._controls.enabled=!1)}},{key:"_enableControl",value:function(){this._controls&&(this._controls.enabled||(this._controls.enabled=!0,this._restoreOrbitData()))}},{key:"_saveOrbitData",value:function(){this._orbitData={target:new TROIS.Vector3,position:new TROIS.Vector3,zoom:this._controls.object.zoom},this._orbitData.target.copy(this._controls.target),this._orbitData.position.copy(this._controls.object.position)}},{key:"_restoreOrbitData",value:function(){this._controls.position0.copy(this._orbitData.position),this._cameraFollowObject?this._controls.target0.copy(this._planeContainer.position):this._controls.target0.copy(this._orbitData.target),this._controls.zoom0=this._orbitData.zoom,this._controls.reset()}},{key:"_castedRayForRotation",value:function(intersect){this._interacting=!0;var intersectPlane=intersect.object;this._rotateConfig.originalObjectRotation=this._planeContainer.rotation.clone(),this._rotateConfig.hitPoint2D=this._mouse.clone(),this._rotateConfig.planeNormalInternal3D=intersectPlane.userData.normalV.clone(),this._rotateConfig.planeNormalWorld3D=intersectPlane.userData.normalV.clone().applyQuaternion(this._planeContainer.quaternion).normalize(),this._rotateConfig.center3D=this._planeContainer.getWorldPosition(),this._rotateConfig.center2D=this._getScreenCoord(this._rotateConfig.center3D),this._rotateConfig.cameraObjectVector=new TROIS.Vector3(this._camera.position.x-this._rotateConfig.center3D.x,this._camera.position.y-this._rotateConfig.center3D.y,this._camera.position.z-this._rotateConfig.center3D.z).normalize(),this._rotateConfig.cameraSign=Math.sign(this._rotateConfig.planeNormalWorld3D.dot(this._rotateConfig.cameraObjectVector))}},{key:"_followRotation",value:function(){var center=this._rotateConfig.center2D,start=this._rotateConfig.hitPoint2D,current=this._mouse.clone(),centerToStart=new TROIS.Vector3(start.x-center.x,start.y-center.y,start.z-center.z).normalize(),centerToCurrent=new TROIS.Vector3(current.x-center.x,current.y-center.y,current.z-center.z).normalize(),angleRad=Math.acos(centerToStart.dot(centerToCurrent)),angleDirection=Math.sign(centerToStart.cross(centerToCurrent).z);this._planeContainer.rotation.set(this._rotateConfig.originalObjectRotation.x,this._rotateConfig.originalObjectRotation.y,this._rotateConfig.originalObjectRotation.z),this._planeContainer.rotateOnAxis(this._rotateConfig.planeNormalInternal3D,angleRad*angleDirection*this._rotateConfig.cameraSign),this._triggerEvents("rotation")}},{key:"enable",value:function(bool){this._enabled=bool}},{key:"on",value:function(eventName,callback){"function"==typeof callback&&eventName in this._customEvents&&this._customEvents[eventName].push(callback)}},{key:"_triggerEvents",value:function(eventName){if(eventName in this._customEvents)for(var events=this._customEvents[eventName],i=0;i<events.length;i++)events[i]()}}]),PlaneShifter}();exports.PlaneShifter=PlaneShifter,Object.defineProperty(exports,"__esModule",{value:!0})})},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.SignalSelectionFilter=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(14),_react2=_interopRequireDefault(_react),_Panel=__webpack_require__(12),_Panel2=_interopRequireDefault(_Panel),_EEGData=__webpack_require__(17),ZIP_URL=window.loris.BaseURL+"/"+window.loris.TestName+"/ajax/GetChannelZip.php";exports.SignalSelectionFilter=function(_Component){function SignalSelectionFilter(props){_classCallCheck(this,SignalSelectionFilter);var _this=_possibleConstructorReturn(this,(SignalSelectionFilter.__proto__||Object.getPrototypeOf(SignalSelectionFilter)).call(this,props));return _this.state={showFilters:!0,hemisphere:"Both",oneCPPPR:"false",electrodeType:[]},_this.setDropdown=_this.setDropdown.bind(_this),
_this}return _inherits(SignalSelectionFilter,_Component),_createClass(SignalSelectionFilter,[{key:"componentWillMount",value:function(){this.props.setFilters([{key:"hemisphere",value:"Both",keyLabel:"Hemisphere:",valueLabel:"Both"},{key:"oneCPPPR",value:"false",keyLabel:"Show channels:",valueLabel:"All channels"}])}},{key:"setDropdown",value:function(key,value,keyLabel,valueLabel){var filters=[];value instanceof Array?value.forEach(function(v){""!==v&&filters.push({key:key,value:v,keyLabel:keyLabel})}):filters.push({key:key,value:value,keyLabel:keyLabel,valueLabel:valueLabel});var signalSelectFilters=this.props.signalSelectFilters.filter(function(f){return!(f.keyLabel===keyLabel)}).concat(filters);this.setState(_defineProperty({},key,value)),this.props.setFilters(signalSelectFilters)}},{key:"render",value:function(){var _this2=this,removeFilterTag=function(filter){var keyLabel=filter.keyLabel,valueLabel=filter.valueLabel,signalSelectFilters=_this2.props.signalSelectFilters.filter(function(f){return!(f.keyLabel===keyLabel&&f.valueLabel===valueLabel)});_this2.props.setFilters(signalSelectFilters)},dropdownProps=function(userInputCallback,props){var onUserInput=function(k,v){return userInputCallback(k,v,props.label,props.options[v])};return Object.assign({onUserInput:onUserInput},props)},filterTagRemover=function(filter){return _react2.default.createElement("span",{className:"tag-remove-button",onClick:function(){return removeFilterTag(filter)}},"x")},regionTagRemover=(this.props.signalSelectFilters.map(function(filter,i){return _react2.default.createElement("span",{key:filter.valueLabel+String(i),className:"selection-filter-tag"},filter.keyLabel,": ",filter.valueLabel," ",filterTagRemover(filter))}),function(region){return _react2.default.createElement("span",{className:"tag-remove-button",onClick:function(){return _this2.props.onRemoveRegion(region)}},"x")}),regionTagElements=this.props.selectedRegions.map(function(region){return _react2.default.createElement("span",{key:region.name,className:"selection-filter-tag"},region.name," ",regionTagRemover(region))}),filterContainer=_react2.default.createElement("div",{className:"selection-filter-tags"},"Region Tags: ",regionTagElements),getZipped=function(){var names=(0,_EEGData.filterChannels)(_this2.props.signalSelectFilters,_this2.props.selectedRegions).map(function(c){return c.metaData.name});if(0!==names.length&&window.confirm("Click OK and please wait")){var formdata=new FormData;formdata.set("channelnames",names.join(",")),fetch(ZIP_URL,{credentials:"include",method:"POST",body:formdata}).then(function(){return fetch(ZIP_URL,{credentials:"include"})}).then(function(res){return res.blob()}).then(function(buffer){var a=document.createElement("a");a.href=URL.createObjectURL(buffer),a.download="ieegSignals.zip",a.click(),URL.revokeObjectURL(a.href)})}},formElements={oneContactPerPatientPerRegion:dropdownProps(this.setDropdown,{type:"select",name:"oneCPPPR",emptyOption:!1,value:this.state.oneCPPPR,label:"Show channels:",options:{false:"All channels",true:"One channel per patient per region"}}),electrodeType:dropdownProps(this.setDropdown,{type:"select",multiple:!0,emptyOption:!1,name:"electrodeType",label:"Electrode Type:",value:this.state.electrodeType,options:{all:"All Types",D:"Dixi sEEG",M:"Custom-built MNI sEEG",A:" Ad-Tech depth",G:"Ad-Tech subdural grid/strip"}}),hemisphere:dropdownProps(this.setDropdown,{type:"select",name:"hemisphere",emptyOption:!1,value:this.state.hemisphere,label:"Hemisphere:",options:{Both:"Both",Left:"Left",Right:"Right"}})},toggleFilters=_react2.default.createElement("div",{style:{display:"inline-block",width:"240px"},className:"round-button "+(0===this.props.selectedRegions.length?"disabled":""),onClick:function(){_this2.setState({showFilters:!_this2.state.showFilters})}},this.state.showFilters?"Hide":"Show"," selected region tags"),removeAllRegions=_react2.default.createElement("div",{style:{display:"inline-block",width:"240px"},className:"round-button "+(0===this.props.selectedRegions.length?"disabled":""),onClick:function(){_this2.props.unselectRegions(_this2.props.selectedRegions||[])}},"Clear region selections");return _react2.default.createElement(_Panel2.default,{title:"Channel Selection Filters"},_react2.default.createElement(FormElement,{name:"selectionFilters",columns:1,formElements:formElements}),_react2.default.createElement("hr",null),_react2.default.createElement("div",{style:{display:"inline-block",width:"240px"},className:"round-button"+(0===this.props.selectedRegions.length?" disabled":""),onClick:getZipped},"Download Selected Raw Signals"),_react2.default.createElement("div",{style:{display:"inline-block",width:"240px"},className:"round-button"},_react2.default.createElement("a",{href:window.loris.BaseURL+"/document_repository",target:"_blank"},"Download Region Files")),_react2.default.createElement("hr",null),_react2.default.createElement("div",{style:{display:"inline-block",width:"240px"},className:"round-button",onClick:function(){return _this2.props.setExpandMode(0===_this2.props.expandMode?1:0)}},0===this.props.expandMode?"Show region menu":"Full width EEG traces"),_react2.default.createElement("div",{style:{display:"inline-block",width:"240px"},className:"round-button",onClick:function(){return _this2.props.setExpandMode(2===_this2.props.expandMode?1:2)}},2===this.props.expandMode?"Hide":"Show"," brain volume visualization"),_react2.default.createElement("hr",null),toggleFilters,removeAllRegions,this.state.showFilters&&filterContainer)}}]),SignalSelectionFilter}(_react.Component)},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.SignalPlots=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(14),_react2=_interopRequireDefault(_react),_SignalPlot=__webpack_require__(28),_SignalProcessingSelect=__webpack_require__(29),_EEGData=__webpack_require__(17),_ResizeObserver=__webpack_require__(30),_ResizeObserver2=_interopRequireDefault(_ResizeObserver),_Filters=__webpack_require__(18),ZOOM_AMOUNT=1,INTERVAL_MOVE_AMOUNT=1,PLOTS_PER_GROUP=8,PLOT_HEIGHT=90,Y_WIDTH=60,INITIAL_T_BOUNDS={tmin:-.1,tmax:20},INITIAL_Y_BOUNDS={ymin:-250,ymax:250};exports.SignalPlots=function(_Component){function SignalPlots(props){_classCallCheck(this,SignalPlots);var _this=_possibleConstructorReturn(this,(SignalPlots.__proto__||Object.getPrototypeOf(SignalPlots)).call(this,props));return _this.lastMouseX=null,_this.drawn=[],_this.state={cursorT:null,group:0,tBounds:INITIAL_T_BOUNDS,baseYBounds:Object.assign({},INITIAL_Y_BOUNDS),yBounds:{},filters:{low:"none",hi:"none"}},_this}return _inherits(SignalPlots,_Component),_createClass(SignalPlots,[{key:"componentWillReceiveProps",value:function(nextProps){var minPlot=(PLOTS_PER_GROUP-1)*this.state.group,numChannels=(0,_EEGData.filterChannels)(nextProps.signalSelectFilters,nextProps.selected).length,newGroup=minPlot>numChannels?Math.floor(numChannels/PLOTS_PER_GROUP):this.state.group;this.setState({group:newGroup})}},{key:"componentDidMount",value:function(){var _this2=this,toolbars=document.querySelectorAll(".toolbar");this.resizeUpdate=function(){var _container$getBoundin=_this2.container.getBoundingClientRect(),left=_container$getBoundin.left;_container$getBoundin.width;document.body.style.width=Math.max(left+600,window.innerWidth-15)+"px",toolbars.forEach(function(e){var _e$getBoundingClientR=e.getBoundingClientRect(),width=_e$getBoundingClientR.width;width<782?e.className="toolbar toolbar-collapse":e.className="toolbar"})},this.resizeObserver=new _ResizeObserver2.default(this.resizeUpdate),this.resizeObserver.observe(this.container),window.addEventListener("resize",this.resizeUpdate),window.addEventListener("mouseup",function(){_this2.lastMouseX=null})}},{key:"componentWillUnmount",value:function(){window.remove("resize",this.resizeUpdate)}},{key:"generatePlotElements",value:function(channels,minPlot,maxPlot){var _this3=this,plotElements=[],index=0;return channels.forEach(function(channel){var _state$filters=_this3.state.filters,low=_state$filters.low,hi=_state$filters.hi;channel.applyFilter(low,hi,function(){return _this3.forceUpdate()});var axisProps={drawXAxis:!1,xAxisLabel:"sec",yAxisLabel:"uV"},showTimeOnCursor=!1;if(index===minPlot&&(showTimeOnCursor=!0,axisProps.drawXAxis=!0,axisProps.xAxisOrientation="top",axisProps.xAxisLabelPos=null,axisProps.yAxisLabelPos={x:-23,y:10}),index===maxPlot&&(axisProps.drawXAxis=!0,axisProps.xAxisOrientation="bottom",axisProps.xAxisLabelPos={x:5,y:28},axisProps.yAxisLabelPos={x:-23,y:7}),index>=minPlot&&index<=maxPlot){var zoom=function(leftClick,multiplier){if(leftClick){if(!_this3.state.yBounds[channel.metaData.name]){var _state$baseYBounds=_this3.state.baseYBounds,_ymin2=_state$baseYBounds.ymin,_ymax2=_state$baseYBounds.ymax;_this3.state.yBounds[channel.metaData.name]={ymin:_ymin2,ymax:_ymax2}}var _state$yBounds$channe=_this3.state.yBounds[channel.metaData.name],_ymin=_state$yBounds$channe.ymin,_ymax=_state$yBounds$channe.ymax;_ymin*=multiplier,_ymax*=multiplier,_this3.state.yBounds[channel.metaData.name]={ymin:_ymin,ymax:_ymax},_this3.setState({yBounds:_this3.state.yBounds})}},_ref=_this3.state.yBounds[channel.metaData.name]||_this3.state.baseYBounds,ymin=_ref.ymin,ymax=_ref.ymax;plotElements.push(_react2.default.createElement(_SignalPlot.SignalPlot,{key:channel.metaData.name+"-"+index,className:"signal-plot-item",channel:channel,colorCode:channel.colorCode,height:PLOT_HEIGHT,yAxisWidth:Y_WIDTH,tBounds:_this3.state.tBounds,yBounds:{ymin:ymin,ymax:ymax},onPlus:function(e){e.stopPropagation(),zoom(0===e.button,.9)},onMinus:function(e){e.stopPropagation(),zoom(0===e.button,1.1)},backgroundColor:"#fff",cursorT:_this3.state.cursorT,drawXAxis:axisProps.drawXAxis,xAxisOrientation:axisProps.xAxisOrientation,xAxisLabel:axisProps.xAxisLabel,xAxisLabelPos:axisProps.xAxisLabelPos,yAxisLabel:axisProps.yAxisLabel,yAxisLabelPos:axisProps.yAxisLabelPos,showTimeOnCursor:showTimeOnCursor}))}index++}),plotElements}},{key:"render",value:function(){var _this4=this,_onWheel=function(dy){var _state$tBounds=_this4.state.tBounds,tmin=_state$tBounds.tmin,tmax=_state$tBounds.tmax;tmax-tmin<=.5&&dy<0||tmax-tmin>=25&&dy>0||_this4.setState({tBounds:{tmin:tmin-Math.sign(dy)*ZOOM_AMOUNT*(tmax-tmin)/15,tmax:tmax+Math.sign(dy)*ZOOM_AMOUNT*(tmax-tmin)/15}})},_onMouseMove=function(shift,leftClick,x){if(!_this4.lastMouseX)return void(_this4.lastMouseX=x);if(_this4.container){var _container$getBoundin2=_this4.container.getBoundingClientRect(),width=_container$getBoundin2.width,left=_container$getBoundin2.left,_state$tBounds2=_this4.state.tBounds,tmin=_state$tBounds2.tmin,tmax=_state$tBounds2.tmax,dx=x-_this4.lastMouseX;if(_this4.lastMouseX=x,shift&&leftClick){var cappedDx=dx;tmin<=-10&&(cappedDx=Math.min(dx,0)),tmax>=70&&(cappedDx=Math.max(dx,0)),_this4.setState({tBounds:{tmin:tmin-cappedDx*INTERVAL_MOVE_AMOUNT*(tmax-tmin)/width,tmax:tmax-cappedDx*INTERVAL_MOVE_AMOUNT*(tmax-tmin)/width}})}if(!shift&&leftClick){var tInv=d3.scale.linear().domain([Y_WIDTH,width-Y_WIDTH/4]).range([tmin,tmax]);x-left>Y_WIDTH&&_this4.setState({cursorT:tInv(x-left)})}}},selectLow=function(value){_this4.setState({filters:{low:value,hi:_this4.state.filters.hi}})},selectHi=function(value){_this4.setState({filters:{low:_this4.state.filters.low,hi:value}})},enabled=function(text,incr){return _react2.default.createElement("div",{style:{width:"130px"},className:"round-button",onClick:function(){_this4.setState({group:_this4.state.group+incr})}},text)},disabled=function(text){return _react2.default.createElement("div",{style:{width:"130px"},className:"round-button disabled"},text)},filtered=(0,_EEGData.filterChannels)(this.props.signalSelectFilters,this.props.selected),minPlot=(PLOTS_PER_GROUP-1)*this.state.group,maxPlot=(PLOTS_PER_GROUP-1)*(this.state.group+1),numChannels=filtered.length,showNext=maxPlot<numChannels,showPrev=this.state.group>0;minPlot+PLOTS_PER_GROUP>numChannels&&(maxPlot=Math.min(minPlot+PLOTS_PER_GROUP,numChannels)-1);var plotElements=this.generatePlotElements(filtered,minPlot,maxPlot),showingPlots=_react2.default.createElement("h6",null,"Showing traces: ",minPlot+1," to ",maxPlot+1," out of ",numChannels,".  Shift + mouse scroll to zoom time scale. Shift + mouse drag to move along time axis."),noPlotsScreen=_react2.default.createElement("div",{className:"no-plots-screen"},_react2.default.createElement("h4",null,"Select a region or lobe to display signals.")),zoomAll=function(leftClick,multiplier){if(leftClick){var _state$baseYBounds2=_this4.state.baseYBounds,ymin=_state$baseYBounds2.ymin,ymax=_state$baseYBounds2.ymax;ymin*=multiplier,ymax*=multiplier,Object.keys(_this4.state.yBounds).forEach(function(key){var _state$yBounds$key=_this4.state.yBounds[key],ymin=_state$yBounds$key.ymin,ymax=_state$yBounds$key.ymax;ymin*=multiplier,ymax*=multiplier,_this4.state.yBounds[key]={ymin:ymin,ymax:ymax}}),_this4.setState({baseYBounds:{ymin:ymin,ymax:ymax},yBounds:_this4.state.yBounds})}},updatePage=function(leftClick,direction){if(leftClick){var _state$tBounds3=_this4.state.tBounds,tmin=_state$tBounds3.tmin,tmax=_state$tBounds3.tmax,interval=Math.abs(tmax-tmin);tmin+=interval*direction,tmax+=interval*direction,tmax=Math.min(Math.max(tmax,interval),70),tmin=tmax-interval,_this4.setState({tBounds:{tmin:tmin,tmax:tmax}})}},updateTime=function(leftClick,increment){if(leftClick){var _state$tBounds4=_this4.state.tBounds,tmin=_state$tBounds4.tmin,tmax=_state$tBounds4.tmax,interval=Math.abs(tmax-tmin);tmin+=increment,tmax+=increment,tmax=Math.min(Math.max(tmax,interval-10),70),tmin=tmax-interval,_this4.setState({tBounds:{tmin:tmin,tmax:tmax}})}},timeControl=_react2.default.createElement("div",{className:"toolbar-hor-group"},_react2.default.createElement("div",{className:"round-button",style:{marginRight:"1px"},onClick:function(e){updatePage(0===e.button,-1)}},"<<"),_react2.default.createElement("div",{className:"round-button round-button--padded",style:{marginLeft:"1px",marginRight:"1px"},onClick:function(e){updateTime(0===e.button,-1)}},"<"),_react2.default.createElement("div",{className:"round-button round-button--padded",style:{marginLeft:"1px",marginRight:"1px"},onClick:function(e){updateTime(0===e.button,1)}},">"),_react2.default.createElement("div",{className:"round-button",style:{marginLeft:"1px"},onClick:function(e){updatePage(0===e.button,1)}},">>"));return _react2.default.createElement("div",{className:"signal-plots-container"},numChannels>0?showingPlots:null,_react2.default.createElement("div",{className:"toolbar"},_react2.default.createElement("div",{className:"toolbar-layer"},_react2.default.createElement("div",{className:"toolbar-hor-group"},_react2.default.createElement("div",{className:"round-button round-button--padded",style:{marginRight:"1px"},onClick:function(e){zoomAll(0===e.button,1.1)}},"-"),_react2.default.createElement("div",{className:"round-button",style:{marginLeft:"1px",marginRight:"1px"},onClick:function(){_this4.setState({yBounds:{},baseYBounds:Object.assign({},INITIAL_Y_BOUNDS)})}},"Reset"),_react2.default.createElement("div",{className:"round-button round-button--padded",style:{marginLeft:"1px"},onClick:function(e){zoomAll(0===e.button,.9)}},"+")),_react2.default.createElement("div",{className:"toolbar-hor-group"},timeControl),_react2.default.createElement("div",{className:"signal-plots-filters"},_react2.default.createElement(_SignalProcessingSelect.SignalProcessingSelect,{filters:_Filters.HIGH_PASS_FILTERS,filter:this.state.filters.hi,onChange:selectHi}),_react2.default.createElement(_SignalProcessingSelect.SignalProcessingSelect,{filters:_Filters.LOW_PASS_FILTERS,filter:this.state.filters.low,onChange:selectLow}))),_react2.default.createElement("div",{className:"toolbar-layer"},_react2.default.createElement("div",{className:"toolbar-hor-group"},showPrev?enabled("Previous Channels",-1):disabled("Previous Channels"),showNext?enabled("Next Channels",1):disabled("Next Channels")))),_react2.default.createElement("div",{className:"signal-plots"+(0===plotElements.length?" padded-bottom":""),ref:function(container){_this4.container=container},onWheel:function(e){e.shiftKey&&(e.preventDefault(),_onWheel(e.deltaY))},onMouseMove:function(e){_onMouseMove(e.shiftKey,e.buttons>0&&0===e.button,e.clientX)},onMouseDown:function(e){_onMouseMove(e.shiftKey,e.buttons>0&&0===e.button,e.clientX)}},0===plotElements.length?noPlotsScreen:plotElements))}}]),SignalPlots}(_react.Component)},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.SignalPlot=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(14),_react2=_interopRequireDefault(_react),CURSOR_FONT_SIZE=10,STATS_TOP_OFFSET=27,drawSignalLine=function(ctx,tScale,yScale,channel,indexes){var startx=tScale(channel.domain[indexes[0]]),starty=yScale(channel.signal[indexes[0]]);ctx.strokeStyle="#000",ctx.lineWidth=.4,ctx.moveTo(startx,starty),ctx.beginPath(),indexes.forEach(function(i){var _ref=[tScale(channel.domain[i]),yScale(channel.signal[i])],x=_ref[0],y=_ref[1];ctx.lineTo(x,y)}),ctx.stroke()},drawSecondTicks=function(ctx,height,tScale,tmin,tmax){var ctmin=Math.ceil(tmin),ctmax=Math.ceil(tmax);ctx.strokeStyle="#999",ctx.lineWidth=.3;for(var t=ctmin;t<ctmax;t++)ctx.beginPath(),ctx.moveTo(tScale(t),0),ctx.lineTo(tScale(t),height),ctx.stroke()},drawCursorTick=function(g,height,x){return g.append("line").attr({x1:x,y1:0}).attr({x2:x,y2:height}).attr("stroke-width",1).attr("stroke","#900")},drawRegionColorCode=function(g,height,color){return g.append("line").attr({x1:5,y1:0}).attr({x2:5,y2:height}).attr("stroke-width",4).attr("stroke","rgba("+color.r+", "+color.g+", "+color.b+", 1.0)")};exports.SignalPlot=function(_Component){function SignalPlot(props){_classCallCheck(this,SignalPlot);var _this=_possibleConstructorReturn(this,(SignalPlot.__proto__||Object.getPrototypeOf(SignalPlot)).call(this,props));return _this.svg=null,_this.state={channelResolved:!1},_this}return _inherits(SignalPlot,_Component),_createClass(SignalPlot,[{key:"getDimensions",value:function(){var _props=this.props,width=_props.width,height=_props.height;return width?{width:width,height:height}:{width:this.div.getBoundingClientRect().width-(this.props.yAxisWidth||60),height:height}}},{key:"getD3Scales",value:function(){var _props$tBounds=this.props.tBounds,tmin=_props$tBounds.tmin,tmax=_props$tBounds.tmax,_props$yBounds=this.props.yBounds,ymin=_props$yBounds.ymin,ymax=_props$yBounds.ymax,_getDimensions=this.getDimensions(),width=_getDimensions.width,height=_getDimensions.height,t=d3.scale.linear().domain([tmin,tmax]).rangeRound([0,width]),tInv=d3.scale.linear().domain([0,width]).range([tmin,tmax]),y=d3.scale.linear().domain([ymin,ymax]).rangeRound([height,0]),yInv=d3.scale.linear().domain([0,height]).range([ymax,ymin]);return{t:t,y:y,tInv:tInv,yInv:yInv}}},{key:"getD3Axes",value:function(){var _getD3Scales=this.getD3Scales(),t=_getD3Scales.t,y=_getD3Scales.y,yInv=_getD3Scales.yInv,xAxis=d3.svg.axis().scale(t).ticks(10).outerTickSize(0).orient("bottom"),upperYLabelVal=Math.round(10*yInv(.75*this.props.height))/10,lowerYLabelVal=Math.round(10*yInv(.25*this.props.height))/10,yAxis=d3.svg.axis().scale(y).ticks(0).tickValues([lowerYLabelVal,0,upperYLabelVal]).outerTickSize(0).orient("left");return{xAxis:xAxis,yAxis:yAxis}}},{key:"getSignalIndexes",value:function(){var _props2=this.props,channel=_props2.channel,cursorT=_props2.cursorT,_props$tBounds2=this.props.tBounds,tmin=_props$tBounds2.tmin,tmax=_props$tBounds2.tmax,cursTime="NA",cursVal="NA";cursorT&&(cursTime=Math.round(100*cursorT)/100);var ts=channel.domain,indexFilter=function(indexes,t,i){if(t>=tmin&&t<=tmax&&(indexes.push(i),i<ts.length-1&&cursorT>=t&&cursorT<ts[i+1])){var v1=channel.signal[i],v2=channel.signal[i+1],s=(cursorT-ts[i])/(ts[i+1]-ts[i]);cursVal=v1*(1-s)+v2*s,cursVal=Math.round(100*cursVal)/100}return indexes},indexes=ts.reduce(indexFilter,[]);return{indexes:indexes,cursTime:cursTime,cursVal:cursVal}}},{key:"componentDidMount",value:function(){var _this2=this;this.props.channel&&this.props.channel.fetch().then(function(){_this2.div&&(_this2.renderPlot(),_this2.updatePlot(),_this2.setState({channelResolved:!0}))})}},{key:"componentDidUpdate",value:function(){this.state.channelResolved&&this.updatePlot()}},{key:"drawYScaleButton",value:function(parent,symbol,x,y){var g=parent.append("g").attr("transform","translate("+x+", "+y+")");return g.attr("class","plot-scale-button").attr("cursor","pointer"),g.append("rect").attr("x",-2).attr("y",-10).attr("width","12px").attr("height","12px").attr("fill","#aaa"),g.append("text").attr("x",4).attr("y",0).attr("font-weight","bold").attr("fill","#000").attr("text-anchor","middle").text(symbol),g}},{key:"drawLink",value:function(svg){if(this.link){var svgHeight=svg.node().getBoundingClientRect().height,axisWidth=this.props.yAxisWidth||60;d3.select(this.link).style("left",axisWidth+10+"px").style("top",-(svgHeight+23)+"px")}}},{key:"drawXAxes",value:function(svg,parent){var xAx=null,_getDimensions2=this.getDimensions(),height=_getDimensions2.height,_getD3Axes=this.getD3Axes(),xAxis=_getD3Axes.xAxis,_props3=this.props,xAxisLabel=_props3.xAxisLabel,yAxisLabel=_props3.yAxisLabel;if(xAx=parent.append("g").call(xAxis),"top"===this.props.xAxisOrientation&&xAx.attr("transform","translate(0, 0)"),"bottom"===this.props.xAxisOrientation&&(xAx.attr("transform","translate(0, "+height+")"),svg.attr("height",height+50).style("height",height+50+"px")),xAxisLabel&&this.props.xAxisLabelPos){var _props$xAxisLabelPos=this.props.xAxisLabelPos,x=_props$xAxisLabelPos.x,y=_props$xAxisLabelPos.y;xAx.append("text").attr("x",x).attr("y",y).text(xAxisLabel)}if(yAxisLabel&&this.props.yAxisLabelPos){var _props$yAxisLabelPos=this.props.yAxisLabelPos,_x=_props$yAxisLabelPos.x,_y=_props$yAxisLabelPos.y;xAx.append("text").attr("x",_x).attr("y",_y).text(yAxisLabel)}return xAx}},{key:"updatePlot",value:function(){var _this3=this,channel=this.props.channel,_getD3Scales2=this.getD3Scales(),t=_getD3Scales2.t,y=_getD3Scales2.y,_getD3Axes2=this.getD3Axes(),yAxis=_getD3Axes2.yAxis,_props$tBounds3=this.props.tBounds,tmin=_props$tBounds3.tmin,tmax=_props$tBounds3.tmax,_getDimensions3=this.getDimensions(),width=_getDimensions3.width,height=_getDimensions3.height,_plot=this.plot,div=_plot.div,svg=_plot.svg,g=_plot.g,_getSignalIndexes=this.getSignalIndexes(),indexes=_getSignalIndexes.indexes,cursTime=_getSignalIndexes.cursTime,cursVal=_getSignalIndexes.cursVal;if(this.drawLink(svg),this.plot.cursorTick&&(this.plot.cursorTick.remove(),this.plot.cursorTick=null),this.plot.cursorStats&&(this.plot.cursorStats.remove(),this.plot.cursorStats=null),this.props.cursorT){var cursorPos=t(this.props.cursorT);if(0<=cursorPos&&cursorPos<=width){var cursText=this.props.showTimeOnCursor?cursTime+" "+this.props.xAxisLabel+" | ":" ";this.plot.cursorTick=drawCursorTick(g,height,cursorPos),this.plot.cursorStats=g.append("text").attr("x",cursorPos).attr("y",STATS_TOP_OFFSET).attr("font-size",CURSOR_FONT_SIZE).text(cursText+" "+cursVal+" "+this.props.yAxisLabel)}}this.plot.xAx&&(this.plot.xAx.remove(),this.plot.xAx=null),div.style("height",height+"px"),svg.attr("height",height).style("min-height",height+"px"),this.props.drawXAxis&&(this.plot.xAx=this.drawXAxes(svg,g)),this.plot.yAx.call(yAxis),this.plot.regionColorCode.remove(),this.plot.regionColorCode=drawRegionColorCode(svg,height,this.props.colorCode);var _plot$canvas$node$get=this.plot.canvas.node().getBoundingClientRect(),_width=_plot$canvas$node$get.width,_height=_plot$canvas$node$get.height;this.plot.canvas.attr("width",_width).attr("height",_height),this.plot.ctx.clearRect(0,0,width,height),this.props.backgroundColor&&(this.plot.ctx.fillStyle=this.props.backgroundColor,this.plot.ctx.fillRect(0,0,width,height)),drawSignalLine(this.plot.ctx,t,y,channel,indexes),drawSecondTicks(this.plot.ctx,height,t,tmin,tmax),this.plot.btnPlus&&(this.plot.btnPlus.remove(),this.plot.btnPlus=null),this.plot.btnMinus&&(this.plot.btnMinus.remove(),this.plot.btnMinus=null),this.props.onPlus&&(this.plot.btnPlus=this.drawYScaleButton(g,"+",width-25,20),this.plot.btnPlus.on("mousedown",function(){return _this3.props.onPlus(d3.event)})),this.props.onMinus&&(this.plot.btnMinus=this.drawYScaleButton(g,"-",width-25,height-10),this.plot.btnMinus.on("mousedown",function(){return _this3.props.onMinus(d3.event)}))}},{key:"renderPlot",value:function(){var _this4=this,_props4=this.props,channel=_props4.channel,yAxisWidth=_props4.yAxisWidth,_props$tBounds4=this.props.tBounds,tmin=_props$tBounds4.tmin,tmax=_props$tBounds4.tmax,_getD3Scales3=this.getD3Scales(),t=_getD3Scales3.t,y=_getD3Scales3.y,_getD3Axes3=this.getD3Axes(),yAxis=_getD3Axes3.yAxis,_getDimensions4=this.getDimensions(),width=_getDimensions4.width,height=_getDimensions4.height,div=d3.select(this.div).style("height",height+"px").style("width","100%"),svg=d3.select(this.svg).attr("height",height).style("min-height",height+"px").style("position","relative").style("top",-height+"px"),g=svg.append("g").attr("transform","translate("+(60|yAxisWidth)+", 0)").attr("width","100%"),canvas=d3.select(this.canvas).attr("x",yAxisWidth||60).attr("y",0).attr("width",width).attr("height",height).style("position","relative").style("left",(yAxisWidth||60)+"px").style("display","flex").style("width","100%").style("height",height+"px").style("margin-right","0"),ctx=canvas.node().getContext("2d");this.props.backgroundColor&&(ctx.fillStyle=this.props.backgroundColor,ctx.fillRect(0,0,width,height));var yAx=g.append("g").call(yAxis),regionColorCode=drawRegionColorCode(svg,height,this.props.colorCode);this.drawLink(svg);var _getSignalIndexes2=this.getSignalIndexes(),indexes=_getSignalIndexes2.indexes,cursTime=_getSignalIndexes2.cursTime,cursVal=_getSignalIndexes2.cursVal;drawSignalLine(ctx,t,y,channel,indexes),drawSecondTicks(ctx,height,t,tmin,tmax);var cursorTick=null,cursorStats=null;if(this.props.cursorT){var cursorPos=t(this.props.cursorT);if(0>=cursorPos&&cursorPos<=width){var cursText=this.props.showTimeOnCursor?cursTime+" "+this.props.xAxisLabel+" | ":" ";cursorTick=drawCursorTick(g,height,cursorPos),cursorStats=g.append("text").attr("x",cursorPos).attr("y",STATS_TOP_OFFSET).attr("font-size",CURSOR_FONT_SIZE).text(cursText+" "+cursVal+" "+this.props.yAxisLabel)}}var xAx=null;svg.attr("height",height).style("min-height",height+"px"),this.props.drawXAxis&&(xAx=this.drawXAxes(svg,g));var btnPlus=void 0;this.props.onPlus&&(btnPlus=this.drawYScaleButton(g,"+",width-25,20),btnPlus.on("mousedown",function(){return _this4.props.onPlus(d3.event)}));var btnMinus=void 0;this.props.onMinus&&(btnMinus=this.drawYScaleButton(g,"-",width-25,height-10),btnMinus.on("mousedown",function(){return _this4.props.onMinus(d3.event)})),this.plot={div:div,svg:svg,g:g,xAx:xAx,yAx:yAx,height:height,regionColorCode:regionColorCode,channel:channel,cursorStats:cursorStats,canvas:canvas,ctx:ctx,cursorTick:cursorTick,btnPlus:btnPlus,btnMinus:btnMinus}}},{key:"render",value:function(){var _this5=this;return _react2.default.createElement("div",{ref:function(div){_this5.div=div}},_react2.default.createElement("canvas",{ref:function(canvas){_this5.canvas=canvas}}),_react2.default.createElement("svg",{className:"signal-plot-item",ref:function(svg){_this5.svg=svg}}),_react2.default.createElement("a",{className:"channel-link",href:loris.BaseURL+"/"+loris.TestName+"/GetChannel.php?channelname="+this.props.channel.metaData.name,ref:function(link){_this5.link=link},onMouseDown:function(e){e.stopPropagation()},download:this.props.channel.metaData.name+".edf"},this.props.channel.metaData.name))}}]),SignalPlot}(_react.Component)},function(module,exports,__webpack_require__){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.SignalProcessingSelect=void 0;var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_react=__webpack_require__(14),_react2=_interopRequireDefault(_react);exports.SignalProcessingSelect=function(_Component){
function SignalProcessingSelect(props){return _classCallCheck(this,SignalProcessingSelect),_possibleConstructorReturn(this,(SignalProcessingSelect.__proto__||Object.getPrototypeOf(SignalProcessingSelect)).call(this,props))}return _inherits(SignalProcessingSelect,_Component),_createClass(SignalProcessingSelect,[{key:"render",value:function(){var _this2=this,optionElement=function(option){return _react2.default.createElement("option",{key:option.key,value:option.key},option.label)};return _react2.default.createElement("select",{className:"signal-filter-dropdown",onChange:function(e){_this2.props.onChange(e.target.value)},value:this.props.filter},this.props.filters.map(optionElement))}}]),SignalProcessingSelect}(_react.Component)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_RESULT__;(function(global){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!function(global,factory){"object"===_typeof(exports)&&"undefined"!=typeof module?module.exports=factory():(__WEBPACK_AMD_DEFINE_FACTORY__=factory,__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.call(exports,__webpack_require__,exports,module):__WEBPACK_AMD_DEFINE_FACTORY__,!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}(void 0,function(){function toFloat(value){return parseFloat(value)||0}function getBordersSize(styles){for(var positions=[],len=arguments.length-1;len-- >0;)positions[len]=arguments[len+1];return positions.reduce(function(size,position){var value=styles["border-"+position+"-width"];return size+toFloat(value)},0)}function getPaddings(styles){for(var positions=["top","right","bottom","left"],paddings={},i=0,list=positions;i<list.length;i+=1){var position=list[i],value=styles["padding-"+position];paddings[position]=toFloat(value)}return paddings}function getSVGContentRect(target){var bbox=target.getBBox();return createRectInit(0,0,bbox.width,bbox.height)}function getHTMLElementContentRect(target){var clientWidth=target.clientWidth,clientHeight=target.clientHeight;if(!clientWidth&&!clientHeight)return emptyRect;var styles=getWindowOf(target).getComputedStyle(target),paddings=getPaddings(styles),horizPad=paddings.left+paddings.right,vertPad=paddings.top+paddings.bottom,width=toFloat(styles.width),height=toFloat(styles.height);if("border-box"===styles.boxSizing&&(Math.round(width+horizPad)!==clientWidth&&(width-=getBordersSize(styles,"left","right")+horizPad),Math.round(height+vertPad)!==clientHeight&&(height-=getBordersSize(styles,"top","bottom")+vertPad)),!isDocumentElement(target)){var vertScrollbar=Math.round(width+horizPad)-clientWidth,horizScrollbar=Math.round(height+vertPad)-clientHeight;1!==Math.abs(vertScrollbar)&&(width-=vertScrollbar),1!==Math.abs(horizScrollbar)&&(height-=horizScrollbar)}return createRectInit(paddings.left,paddings.top,width,height)}function isDocumentElement(target){return target===getWindowOf(target).document.documentElement}function getContentRect(target){return isBrowser?isSVGGraphicsElement(target)?getSVGContentRect(target):getHTMLElementContentRect(target):emptyRect}function createReadOnlyRect(ref){var x=ref.x,y=ref.y,width=ref.width,height=ref.height,Constr="undefined"!=typeof DOMRectReadOnly?DOMRectReadOnly:Object,rect=Object.create(Constr.prototype);return defineConfigurable(rect,{x:x,y:y,width:width,height:height,top:y,right:x+width,bottom:height+y,left:x}),rect}function createRectInit(x,y,width,height){return{x:x,y:y,width:width,height:height}}var MapShim=function(){function getIndex(arr,key){var result=-1;return arr.some(function(entry,index){return entry[0]===key&&(result=index,!0)}),result}return"undefined"!=typeof Map?Map:function(){function anonymous(){this.__entries__=[]}var prototypeAccessors={size:{configurable:!0}};return prototypeAccessors.size.get=function(){return this.__entries__.length},anonymous.prototype.get=function(key){var index=getIndex(this.__entries__,key),entry=this.__entries__[index];return entry&&entry[1]},anonymous.prototype.set=function(key,value){var index=getIndex(this.__entries__,key);~index?this.__entries__[index][1]=value:this.__entries__.push([key,value])},anonymous.prototype.delete=function(key){var entries=this.__entries__,index=getIndex(entries,key);~index&&entries.splice(index,1)},anonymous.prototype.has=function(key){return!!~getIndex(this.__entries__,key)},anonymous.prototype.clear=function(){this.__entries__.splice(0)},anonymous.prototype.forEach=function(callback,ctx){var this$1=this;void 0===ctx&&(ctx=null);for(var i=0,list=this$1.__entries__;i<list.length;i+=1){var entry=list[i];callback.call(ctx,entry[1],entry[0])}},Object.defineProperties(anonymous.prototype,prototypeAccessors),anonymous}()}(),isBrowser="undefined"!=typeof window&&"undefined"!=typeof document&&window.document===document,global$1=function(){return"undefined"!=typeof global&&global.Math===Math?global:"undefined"!=typeof self&&self.Math===Math?self:"undefined"!=typeof window&&window.Math===Math?window:Function("return this")()}(),requestAnimationFrame$1=function(){return"function"==typeof requestAnimationFrame?requestAnimationFrame.bind(global$1):function(callback){return setTimeout(function(){return callback(Date.now())},1e3/60)}}(),trailingTimeout=2,throttle=function(callback,delay){function resolvePending(){leadingCall&&(leadingCall=!1,callback()),trailingCall&&proxy()}function timeoutCallback(){requestAnimationFrame$1(resolvePending)}function proxy(){var timeStamp=Date.now();if(leadingCall){if(timeStamp-lastCallTime<trailingTimeout)return;trailingCall=!0}else leadingCall=!0,trailingCall=!1,setTimeout(timeoutCallback,delay);lastCallTime=timeStamp}var leadingCall=!1,trailingCall=!1,lastCallTime=0;return proxy},REFRESH_DELAY=20,transitionKeys=["top","right","bottom","left","width","height","size","weight"],mutationObserverSupported="undefined"!=typeof MutationObserver,ResizeObserverController=function(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=throttle(this.refresh.bind(this),REFRESH_DELAY)};ResizeObserverController.prototype.addObserver=function(observer){~this.observers_.indexOf(observer)||this.observers_.push(observer),this.connected_||this.connect_()},ResizeObserverController.prototype.removeObserver=function(observer){var observers=this.observers_,index=observers.indexOf(observer);~index&&observers.splice(index,1),!observers.length&&this.connected_&&this.disconnect_()},ResizeObserverController.prototype.refresh=function(){var changesDetected=this.updateObservers_();changesDetected&&this.refresh()},ResizeObserverController.prototype.updateObservers_=function(){var activeObservers=this.observers_.filter(function(observer){return observer.gatherActive(),observer.hasActive()});return activeObservers.forEach(function(observer){return observer.broadcastActive()}),activeObservers.length>0},ResizeObserverController.prototype.connect_=function(){isBrowser&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),mutationObserverSupported?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},ResizeObserverController.prototype.disconnect_=function(){isBrowser&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},ResizeObserverController.prototype.onTransitionEnd_=function(ref){var propertyName=ref.propertyName;void 0===propertyName&&(propertyName="");var isReflowProperty=transitionKeys.some(function(key){return!!~propertyName.indexOf(key)});isReflowProperty&&this.refresh()},ResizeObserverController.getInstance=function(){return this.instance_||(this.instance_=new ResizeObserverController),this.instance_},ResizeObserverController.instance_=null;var defineConfigurable=function(target,props){for(var i=0,list=Object.keys(props);i<list.length;i+=1){var key=list[i];Object.defineProperty(target,key,{value:props[key],enumerable:!1,writable:!1,configurable:!0})}return target},getWindowOf=function(target){var ownerGlobal=target&&target.ownerDocument&&target.ownerDocument.defaultView;return ownerGlobal||global$1},emptyRect=createRectInit(0,0,0,0),isSVGGraphicsElement=function(){return"undefined"!=typeof SVGGraphicsElement?function(target){return target instanceof getWindowOf(target).SVGGraphicsElement}:function(target){return target instanceof getWindowOf(target).SVGElement&&"function"==typeof target.getBBox}}(),ResizeObservation=function(target){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=createRectInit(0,0,0,0),this.target=target};ResizeObservation.prototype.isActive=function(){var rect=getContentRect(this.target);return this.contentRect_=rect,rect.width!==this.broadcastWidth||rect.height!==this.broadcastHeight},ResizeObservation.prototype.broadcastRect=function(){var rect=this.contentRect_;return this.broadcastWidth=rect.width,this.broadcastHeight=rect.height,rect};var ResizeObserverEntry=function(target,rectInit){var contentRect=createReadOnlyRect(rectInit);defineConfigurable(this,{target:target,contentRect:contentRect})},ResizeObserverSPI=function(callback,controller,callbackCtx){if(this.activeObservations_=[],this.observations_=new MapShim,"function"!=typeof callback)throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=callback,this.controller_=controller,this.callbackCtx_=callbackCtx};ResizeObserverSPI.prototype.observe=function(target){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(target instanceof getWindowOf(target).Element))throw new TypeError('parameter 1 is not of type "Element".');var observations=this.observations_;observations.has(target)||(observations.set(target,new ResizeObservation(target)),this.controller_.addObserver(this),this.controller_.refresh())}},ResizeObserverSPI.prototype.unobserve=function(target){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if("undefined"!=typeof Element&&Element instanceof Object){if(!(target instanceof getWindowOf(target).Element))throw new TypeError('parameter 1 is not of type "Element".');var observations=this.observations_;observations.has(target)&&(observations.delete(target),observations.size||this.controller_.removeObserver(this))}},ResizeObserverSPI.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},ResizeObserverSPI.prototype.gatherActive=function(){var this$1=this;this.clearActive(),this.observations_.forEach(function(observation){observation.isActive()&&this$1.activeObservations_.push(observation)})},ResizeObserverSPI.prototype.broadcastActive=function(){if(this.hasActive()){var ctx=this.callbackCtx_,entries=this.activeObservations_.map(function(observation){return new ResizeObserverEntry(observation.target,observation.broadcastRect())});this.callback_.call(ctx,entries,ctx),this.clearActive()}},ResizeObserverSPI.prototype.clearActive=function(){this.activeObservations_.splice(0)},ResizeObserverSPI.prototype.hasActive=function(){return this.activeObservations_.length>0};var observers="undefined"!=typeof WeakMap?new WeakMap:new MapShim,ResizeObserver=function ResizeObserver(callback){if(!(this instanceof ResizeObserver))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var controller=ResizeObserverController.getInstance(),observer=new ResizeObserverSPI(callback,controller,this);observers.set(this,observer)};["observe","unobserve","disconnect"].forEach(function(method){ResizeObserver.prototype[method]=function(){return(ref=observers.get(this))[method].apply(ref,arguments);var ref}});var index=function(){return"undefined"!=typeof global$1.ResizeObserver?global$1.ResizeObserver:ResizeObserver}();return index})}).call(exports,function(){return this}())}]);
//# sourceMappingURL=EEGBrowser.js.map